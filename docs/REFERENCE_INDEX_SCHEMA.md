# Reference Index JSON Schema

**File**: `.edgedoc/references.json`
**Version**: 1.0
**Auto-generated by**: `edgedoc graph build`

## Overview

역방향 참조 인덱스는 프로젝트의 모든 문서, 코드, 인터페이스, 용어 간의 관계를 빠르게 조회할 수 있도록 사전 빌드된 JSON 파일입니다.

## Root Structure

```typescript
interface ReferenceIndex {
  version: string;           // "1.0"
  generated: string;         // ISO 8601 timestamp
  features: FeatureIndex;
  code: CodeIndex;
  interfaces: InterfaceIndex;
  terms: TermIndex;
}
```

## FeatureIndex

각 feature의 참조 정보와 역방향 관계를 포함합니다.

```typescript
interface FeatureIndex {
  [featureId: string]: {
    file: string;           // "tasks/features/13_ValidateTerms.md"

    code: {
      uses: string[];       // code_references (feature → code)
      used_by: string[];    // 역방향 (code → feature, import graph)
    };

    features: {
      related: string[];    // related_features 원본
      depends_on: string[]; // 명시적/추론된 의존성
      used_by: string[];    // 역방향 (누가 이 feature를 사용하나)
    };

    interfaces: {
      provides: string[];   // 이 feature가 제공하는 인터페이스 ID
      uses: string[];       // 이 feature가 사용하는 인터페이스 ID
    };

    terms: {
      defines: string[];    // document-scoped 용어 정의
      uses: string[];       // [[Term]] 참조
    };

    tests: {
      tested_by: string[];  // 테스트 파일들
    };
  };
}
```

### Example

```json
{
  "validate-terms": {
    "file": "tasks/features/13_ValidateTerms.md",
    "code": {
      "uses": [
        "src/tools/validate-terms.ts",
        "src/parsers/TermParser.ts",
        "src/tools/term-registry.ts"
      ],
      "used_by": []
    },
    "features": {
      "related": ["06_ValidateAll", "10_Internationalization"],
      "depends_on": [],
      "used_by": ["06_ValidateAll"]
    },
    "interfaces": {
      "provides": [],
      "uses": []
    },
    "terms": {
      "defines": [],
      "uses": ["Term Definition", "Documentation Symbol", "Validation"]
    },
    "tests": {
      "tested_by": []
    }
  }
}
```

## CodeIndex

각 소스 코드 파일의 문서화 상태와 의존성 정보를 포함합니다.

```typescript
interface CodeIndex {
  [filePath: string]: {
    type: 'source' | 'test' | 'config';

    documented_in: string[];  // 이 코드를 참조하는 features

    imports: string[];        // 이 파일이 import하는 파일들
    imported_by: string[];    // 이 파일을 import하는 파일들

    exports?: {               // (optional) export된 심볼
      name: string;
      type: 'function' | 'class' | 'interface' | 'type';
      line: number;
    }[];
  };
}
```

### Example

```json
{
  "src/parsers/TermParser.ts": {
    "type": "source",
    "documented_in": ["validate-terms"],
    "imports": [
      "src/types/terminology.ts"
    ],
    "imported_by": [
      "src/tools/validate-terms.ts",
      "src/tools/term-commands.ts"
    ]
  }
}
```

## InterfaceIndex

Feature 간 인터페이스 연결 정보를 포함합니다.

```typescript
interface InterfaceIndex {
  [interfaceId: string]: {
    file: string;           // "tasks/interfaces/00--01.md"
    from: string;           // 제공하는 feature
    to: string;             // 사용하는 feature
    type: string;           // "command", "data", etc.
    shared_types: string[]; // 사용하는 공용 타입 IDs
  };
}
```

### Example

```json
{
  "00--01": {
    "file": "tasks/interfaces/00--01.md",
    "from": "00_Init",
    "to": "01_ValidateMigration",
    "type": "command",
    "shared_types": ["00--01_00--02_00--03_00--04_00--05"]
  }
}
```

## TermIndex

용어 정의와 사용처 정보를 포함합니다.

```typescript
interface TermIndex {
  [term: string]: {
    definition: {
      file: string;
      line: number;
      scope: 'global' | 'document';
    };
    references: Array<{
      file: string;
      line: number;
      context: string;      // 참조 주변 텍스트
    }>;
    usage_count: number;
  };
}
```

### Example

```json
{
  "Term Definition": {
    "definition": {
      "file": "docs/GLOSSARY.md",
      "line": 123,
      "scope": "global"
    },
    "references": [
      {
        "file": "tasks/features/13_ValidateTerms.md",
        "line": 45,
        "context": "[[Term Definition]]을 추출하여..."
      }
    ],
    "usage_count": 3
  }
}
```

## Usage

### 1. Build Index

```bash
edgedoc graph build
```

### 2. Query Feature

```bash
edgedoc graph query validate-terms
```

### 3. Reverse Lookup (Code → Features)

```bash
edgedoc graph query --code src/parsers/TermParser.ts
```

### 4. Query Interface

```bash
edgedoc graph query --interface 00--01
```

### 5. Query Term

```bash
edgedoc graph query --term "Term Definition"
```

## Validation

인덱스가 올바르게 생성되었는지 확인:

```bash
# 1. 파일 존재 확인
ls -lh .edgedoc/references.json

# 2. JSON 유효성 검사
cat .edgedoc/references.json | jq '.'

# 3. 통계 확인
edgedoc graph query
```

## Schema Version History

### v1.0 (2025-10-25)
- Initial schema
- Features, Code, Interfaces, Terms indexing
- Bidirectional references
- Import graph support

## Notes

- 인덱스는 자동 생성되므로 직접 수정하지 마세요
- 문서나 코드 변경 후 `edgedoc graph build` 재실행 필요
- `.gitignore`에 `.edgedoc/` 추가 권장 (또는 선택적 커밋)
